/**
 ***********************************************************************************************************************
 * @file           : app-ui.c
 * @brief          : UI界面的业务逻辑处理
 * @author         : 李嘉豪
 * @date           : 2025-07-05
 ***********************************************************************************************************************
 * @attention
 *
 * UI界面的业务逻辑处理文件
 *
 ***********************************************************************************************************************
 **/




/* ------- includes --------------------------------------------------------------------------------------------------*/

#include "../Services/graph-service.h"
#include "app-ui.h"
#include <string.h>




/* ------- typedef ---------------------------------------------------------------------------------------------------*/





/* ------- define ----------------------------------------------------------------------------------------------------*/





/* ------- macro -----------------------------------------------------------------------------------------------------*/





/* ------- function prototypes ---------------------------------------------------------------------------------------*/

static void actionWhileBrowse(void* argument);
static void actionWhileEdit(void* argument);
static void actionWhileFigureView(void* argument);

static uint8_t conditionBorwse2Edit(void* argument);
static uint8_t conditionEdit2Browse(void* argument);
static uint8_t conditionBrowse2FigureView(void* argument);
static uint8_t conditionFigureView2Browse(void* argument);
static uint8_t conditionEdit2FigureView(void* argument);
static uint8_t conditionFigureView2Edit(void* argument);




/* ------- variables -------------------------------------------------------------------------------------------------*/



static uiStateTransitionTypeDef uiStateMachineList[] = {
    {UI_STATE_ADJUST_BROUWSE, UI_STATE_ADJUST_EDIT, conditionBorwse2Edit, actionWhileBrowse},
    {UI_STATE_ADJUST_EDIT, UI_STATE_ADJUST_BROUWSE, conditionEdit2Browse, actionWhileEdit},
    {UI_STATE_ADJUST_BROUWSE, UI_STATE_FIGURE_VIEW, conditionBrowse2FigureView, actionWhileBrowse},
    {UI_STATE_FIGURE_VIEW, UI_STATE_ADJUST_BROUWSE, conditionFigureView2Browse, actionWhileFigureView},
    {UI_STATE_ADJUST_EDIT, UI_STATE_FIGURE_VIEW, conditionEdit2FigureView, actionWhileEdit},
    {UI_STATE_FIGURE_VIEW, UI_STATE_ADJUST_EDIT, conditionFigureView2Edit, actionWhileFigureView},
};

static uiStateTypeDef uiCurrentState;
static uiStateTypeDef uiLastState;

const uint8_t img[1024] = {
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x40, 0xF0, 0x0C, 0x10, 0x50, 0x50, 0x54, 0x58, 0x50, 0x50, 0x10, 0x00, 0x80, 0x80, 0xBC, 0xA4, 0xA4,
    0xA4, 0xA4, 0xA4, 0xBC, 0x80, 0x80, 0x00, 0x00, 0x10, 0x10, 0xF8, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x40, 0xF0, 0x0C, 0x10, 0x50, 0x50, 0x54,
    0x58, 0x50, 0x50, 0x10, 0x00, 0x80, 0x80, 0xBC, 0xA4, 0xA4, 0xA4, 0xA4, 0xA4, 0xBC, 0x80, 0x80, 0x00, 0x00, 0x30,
    0x08, 0x08, 0x08, 0xF0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x80, 0x80, 0x80, 0x80,
    0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80,
    0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0xFF, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0xBF, 0x80,
    0x80, 0xBD, 0x95, 0x95, 0x95, 0x95, 0xBD, 0x80, 0x80, 0x80, 0x80, 0x86, 0x85, 0x84, 0x84, 0x84, 0xA4, 0xA4, 0x9C,
    0x80, 0x80, 0x80, 0x88, 0x88, 0x8F, 0x88, 0x88, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0xFF, 0x80, 0x80,
    0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0xBF, 0x80, 0x80, 0xBD, 0x95, 0x95, 0x95, 0x95, 0xBD, 0x80, 0x80,
    0x80, 0x80, 0x86, 0x85, 0x84, 0x84, 0x84, 0xA4, 0xA4, 0x9C, 0x80, 0x80, 0x80, 0x88, 0x8C, 0x8A, 0x89, 0x88, 0x80,
    0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x00, 0x00, 0x00, 0x40, 0x78, 0x40, 0xFC, 0x48, 0x48, 0xE4,
    0x34, 0xAC, 0x24, 0xE4, 0x00, 0x08, 0x28, 0x48, 0x68, 0x58, 0xCC, 0x48, 0x28, 0x48, 0x28, 0x08, 0x00, 0x00, 0x00,
    0x00, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x80, 0x80, 0x80, 0xA4, 0xA3, 0x90, 0x8B, 0x84, 0x82, 0xA7, 0x90, 0x8F, 0x90, 0xA7, 0x80,
    0x88, 0x8A, 0x89, 0x8A, 0x8B, 0xBE, 0x8B, 0x8A, 0x89, 0x8A, 0x88, 0x80, 0x80, 0x80, 0x80, 0xFF, 0x80, 0x80, 0x80,
    0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80,
    0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80,
    0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0xFF, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80,
    0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80,
    0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x00,
    0x00, 0x00, 0xF0, 0x10, 0xFC, 0x10, 0xF0, 0x00, 0x74, 0x54, 0x54, 0x54, 0x74, 0x00, 0x00, 0xF8, 0x28, 0x28, 0xF8,
    0xA8, 0xAC, 0xA8, 0xF8, 0x28, 0x28, 0x00, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x80, 0x80, 0x87, 0x80, 0xBF,
    0x84, 0x87, 0x80, 0xBF, 0x95, 0x9F, 0x95, 0xBF, 0x80, 0xA0, 0x9F, 0x80, 0xA2, 0xA6, 0xAA, 0x92, 0x92, 0xAA, 0xA6,
    0xA0, 0x80, 0x80, 0x80, 0x80, 0xFF, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80,
    0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80,
    0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0xFF, 0x80, 0x80, 0x80,
    0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80,
    0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80,
    0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x00, 0x00, 0x00, 0x20, 0xA0, 0xFC, 0x20, 0x00, 0xF8, 0x48, 0x48,
    0x48, 0x48, 0xF8, 0x00, 0x40, 0xF0, 0x0C, 0x20, 0xA0, 0x20, 0x24, 0x28, 0x20, 0xA0, 0x20, 0x00, 0x00, 0x00, 0x00,
    0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02, 0x01, 0x3F, 0x01, 0x00, 0x3F, 0x12, 0x12, 0x12, 0x12, 0x3F, 0x00, 0x00,
    0x3F, 0x00, 0x20, 0x21, 0x2E, 0x20, 0x30, 0x2C, 0x23, 0x20, 0x00, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};



/* ------- function implement ----------------------------------------------------------------------------------------*/

/**
 * @brief UI应用初始化函数
 *
 * @param argument
 */
void uiAppInit(void* argument) {
    uiAppParamTypeDef* pParam = (uiAppParamTypeDef*)argument;
    memcpy(pParam->graphicsBuffers, img, sizeof(img)); // 初始化图形缓冲区
}

/**
 * @brief UI应用循环函数
 *
 * @param argument
 */
void uiAppLoop(void* argument) {
    // 遍历状态机列表，检查每个状态机的条件函数
    for (int i = 0; i < sizeof(uiStateMachineList) / sizeof(uiStateTransitionTypeDef); i++) {
        if (uiStateMachineList[i].curState == uiCurrentState) {
            if (uiStateMachineList[i].conditionFunc(argument)) {

                uiLastState    = uiCurrentState; // 保存上一个状态
                uiCurrentState = uiStateMachineList[i].nextState;
                break;
            }
            // 执行状态动作函数
            uiStateMachineList[i].actionFunc(argument);
        }
    }
}

/**
 * @brief 浏览状态下的动作函数
 *
 * @param argument
 */
static void actionWhileBrowse(void* argument) {
    uiAppParamTypeDef* pParam = (uiAppParamTypeDef*)argument;

    memcpy(pParam->graphicsBuffers, img, sizeof(img)); // 恢复图形缓冲区
}

/**
 * @brief 编辑状态下的动作函数
 *
 * @param argument
 */
static void actionWhileEdit(void* argument) {}


/**
 * @brief 图形查看状态下的动作函数
 *
 * @param argument
 */
static void actionWhileFigureView(void* argument) { uiAppParamTypeDef* pParam = (uiAppParamTypeDef*)argument; }


/**
 * @brief 浏览状态到编辑状态的转换条件函数
 *
 * @param argument
 * @return uint8_t
 */
static uint8_t conditionBorwse2Edit(void* argument) {
    uiAppParamTypeDef* pParam = (uiAppParamTypeDef*)argument;
    return 0;
}

/**
 * @brief 编辑状态到浏览状态的转换条件函数
 *
 * @param argument
 * @return uint8_t
 */
static uint8_t conditionEdit2Browse(void* argument) {
    uiAppParamTypeDef* pParam = (uiAppParamTypeDef*)argument;
    return 0;
}

/**
 * @brief 浏览状态到图形查看状态的转换条件函数
 *
 * @param argument
 * @return uint8_t
 */
static uint8_t conditionBrowse2FigureView(void* argument) {
    uiAppParamTypeDef* pParam = (uiAppParamTypeDef*)argument;
    return 0;
}

/**
 * @brief 图形查看状态到浏览状态的转换条件函数
 *
 * @param argument
 * @return uint8_t
 */
static uint8_t conditionFigureView2Browse(void* argument) {
    uiAppParamTypeDef* pParam = (uiAppParamTypeDef*)argument;
    return 0;
}

/**
 * @brief 编辑状态到图形查看状态的转换条件函数
 *
 * @param argument
 * @return uint8_t
 */
static uint8_t conditionEdit2FigureView(void* argument) {
    uiAppParamTypeDef* pParam = (uiAppParamTypeDef*)argument;
    return 0;
}

/**
 * @brief 图形查看状态到编辑状态的转换条件函数
 *
 * @param argument
 * @return uint8_t
 */
static uint8_t conditionFigureView2Edit(void* argument) {
    uiAppParamTypeDef* pParam = (uiAppParamTypeDef*)argument;
    return 0;
}
